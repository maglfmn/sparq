{% extends "base.html" %}

{% block title %}Manage Apps{% endblock %}

{% block content %}
<div class="content-card">
    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">
                <a href="{{ url_for('core_bp.settings') }}">
                    <i class="fas fa-cog"></i> Settings
                </a>
            </li>
            <li class="breadcrumb-item active" aria-current="page">
                <i class="fas fa-puzzle-piece" style="color: var(--bs-primary)"></i> App Manager
            </li>
        </ol>
    </nav>

    <div class="settings-header">
        <h2><i class="fas fa-puzzle-piece" style="color: var(--bs-primary)"></i> Manage Applications</h2>
        <p class="text-muted">Enable, disable, or remove installed applications</p>
    </div>

    <div class="apps-grid">
        {% for mod in modules %}
            <div class="app-card">
                <div class="app-card-header">
                    <i class="{{ mod.icon_class }}" style="color: {{ mod.color }}"></i>
                    <div class="app-info">
                        <h3>{{ mod.name }}</h3>
                        <span class="version">v{{ mod.version }}</span>
                    </div>
                    {% if mod.type != 'System' %}
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" 
                                   id="toggle-{{ mod.name|lower }}"
                                   {% if mod.enabled %}checked{% endif %}
                                   onchange="toggleModule('{{ mod.name }}', this.checked)">
                        </div>
                    {% endif %}
                </div>
                
                <div class="app-card-body">
                    <p>{{ mod.description|default('No description available') }}</p>
                </div>

                <div class="app-card-footer">
                    <button class="btn btn-outline-secondary btn-sm" 
                            onclick="showDetails('{{ mod.name }}')">
                        <i class="fas fa-info-circle"></i> Details
                    </button>
                    {% if mod.type != 'System' %}
                        <button class="btn btn-outline-danger btn-sm" 
                                onclick="confirmRemove('{{ mod.name }}')">
                            <i class="fas fa-trash"></i> Remove
                        </button>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    </div>
</div>

<style>
.breadcrumb {
    padding: 0.5rem 0;
    margin-bottom: 1.5rem;
    background: transparent;
}

.breadcrumb-item a {
    color: #6c757d;
    text-decoration: none;
}

.breadcrumb-item a:hover {
    color: var(--bs-primary);
}

.breadcrumb-item i {
    margin-right: 0.5rem;
}

.breadcrumb-item.active {
    color: #495057;
}

.breadcrumb-item + .breadcrumb-item::before {
    content: "â€º";
    color: #6c757d;
}
</style>

<script>
async function toggleModule(moduleName, enabled) {
    try {
        const response = await fetch('/api/modules/toggle', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                module: moduleName,
                enabled: enabled
            })
        });
        
        if (!response.ok) {
            throw new Error('Failed to toggle module');
        }
        
        // Show success message
        showToast(`${moduleName} has been ${enabled ? 'enabled' : 'disabled'}. Refresh required.`);
        
    } catch (error) {
        console.error('Error:', error);
        showToast('Failed to toggle module', 'error');
    }
}

function confirmRemove(moduleName) {
    if (confirm(`Are you sure you want to remove ${moduleName}? This cannot be undone.`)) {
        removeModule(moduleName);
    }
}

async function removeModule(moduleName) {
    // Implementation for module removal
}

function showDetails(moduleName) {
    // Implementation for showing module details
}
</script>

{% endblock %} 